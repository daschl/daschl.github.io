<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Scala on daschl writes. sometimes.</title>
    <link>http://nitschinger.at/tags/scala/</link>
    <description>Recent content in Scala on daschl writes. sometimes.</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 26 Apr 2012 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://nitschinger.at/tags/scala/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Accessing Couchbase from Scala</title>
      <link>http://nitschinger.at/Accessing-Couchbase-from-Scala/</link>
      <pubDate>Thu, 26 Apr 2012 00:00:00 +0000</pubDate>
      
      <guid>http://nitschinger.at/Accessing-Couchbase-from-Scala/</guid>
      <description>&lt;p&gt;In my recent adventure on exploring both &lt;a href=&#34;http://www.couchbase.com/&#34;&gt;Couchbase&lt;/a&gt; and &lt;a href=&#34;http://www.scala-lang.org/&#34;&gt;Scala&lt;/a&gt;, I noticed that there are not
many tutorials out there using both at the same time. We&amp;rsquo;ll use the &lt;a href=&#34;http://www.couchbase.com/develop/java/next&#34;&gt;couchbase-java driver&lt;/a&gt; in its latest
version (1.1), because it provides support for views and Couchbase 2.0. Note that I won&amp;rsquo;t cover installing Couchbase here, since there is plenty of
material &lt;a href=&#34;http://www.couchbase.com/docs/couchbase-manual-2.0/couchbase-getting-started-install.html&#34;&gt;out there&lt;/a&gt;. Also, I assume you have scala and
&lt;a href=&#34;https://github.com/harrah/xsbt&#34;&gt;sbt&lt;/a&gt; already installed. The &lt;a href=&#34;http://typesafe.com/stack&#34;&gt;typesafe stack&lt;/a&gt; provides a convenient shortcut to get you
up and running in minutes, so check it out if you haven&amp;rsquo;t already. For the purpos of simplicity, I assume that your Couchbase instance runs on
&lt;code&gt;localhost&lt;/code&gt;. If it runs elswhere, just modify the URI string later accordingly.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s create the standard directory structure for our project. We&amp;rsquo;ll use sbt to manage our dependencies, so create a &lt;code&gt;build.sbt&lt;/code&gt; file too.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/couchbase-scala
    /src
        /main
            /scala
                Main.scala
    build.sbt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Let&amp;rsquo;s write the &lt;code&gt;build.sbt&lt;/code&gt; first:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;name := &amp;quot;couchbase-scala&amp;quot;

version := &amp;quot;1.0&amp;quot;

scalaVersion := &amp;quot;2.9.2&amp;quot;

resolvers += &amp;quot;Couchbase Maven Repository&amp;quot; at &amp;quot;http://files.couchbase.com/maven2&amp;quot;

libraryDependencies += &amp;quot;couchbase&amp;quot; % &amp;quot;couchbase-client&amp;quot; % &amp;quot;1.1-dp&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We need to add the &lt;a href=&#34;http://files.couchbase.com/maven2&#34;&gt;Couchbase Maven Repository&lt;/a&gt; to our resolvers list, since it contains the Couchbase package and all
its dependencies. The last line adds the actual dependency. If you want the (older) stable release, use &amp;ldquo;1.0.2&amp;rdquo; instead of &amp;ldquo;1.1-dp&amp;rdquo;. Tip: you can browse the
repository directly in your browser and see what versions are available.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s add a simple &lt;code&gt;Main&lt;/code&gt; object in &lt;code&gt;Main.scala&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;object Main extends App {
    println(&amp;quot;Hello World&amp;quot;)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now, start sbt and run the application for the first time:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;couchbase-scala$ sbt
&amp;gt; run
** ((Omitting Fetch and Compile Output)) **
[info] Running Main
Hello World
[success] Total time: 4 s, completed 24.04.2012 11:01:33
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I&amp;rsquo;ve omited the part where sbt resolves our dependencies and compiles the libraries, but the output should look like the one above. Now that we have all our
dependencies in place, we can start talking to the Couchbase server. Here&amp;rsquo;s a short example with synchronous set and get operations (note that no exception
handling takes place here):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import collection.JavaConversions._ 
import collection.mutable.ArrayBuffer

import java.net.URI;
import java.net.ConnectException;

import com.couchbase.client.CouchbaseClient;

object Main extends App {
    val uris = ArrayBuffer(URI.create(&amp;quot;http://127.0.0.1:8091/pools&amp;quot;))
    val client = new CouchbaseClient(uris, &amp;quot;default&amp;quot;, &amp;quot;&amp;quot;)

    client.set(&amp;quot;hello&amp;quot;, 0, &amp;quot;world&amp;quot;)
    println(&amp;quot;Receiving -&amp;gt; &amp;quot; + client.get(&amp;quot;hello&amp;quot;))

    client.shutdown()
    System.exit(0)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Save the file, type &lt;code&gt;run&lt;/code&gt; again in sbt and you should get the following output (you only need to leave the REPL if you&amp;rsquo;ve changed the &lt;code&gt;build.sbt&lt;/code&gt; file):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[info] Compiling 1 Scala source to &amp;lt;Path\to\Sourcecode&amp;gt;\couchbase-scala\target\scala-2.9.2\classes...
[info] Running Main
2012-04-24 11:05:11.850 INFO com.couchbase.client.CouchbaseConnection:  Added {QA sa=/127.0.0.1:11210, #Rops=0, #Wops=0, #iq=0, topRop=null, topWop=null, toWrite=0, interested=0} to connect queue
2012-04-24 11:05:11.856 INFO com.couchbase.client.CouchbaseClient:  viewmode property isn&#39;t defined. Setting viewmode to production mode
2012-04-24 11:05:11.856 INFO com.couchbase.client.CouchbaseConnection:  Connection state changed for sun.nio.ch.SelectionKeyImpl@10319d7
2012-04-24 11:05:11.926 INFO com.couchbase.client.ViewConnection:  Added daschl-notebook/127.0.0.1:8092 to connect queue
Receiving -&amp;gt; world
2012-04-24 11:05:12.360 INFO com.couchbase.client.CouchbaseConnection:  Shut down Couchbase client
2012-04-24 11:05:12.368 INFO com.couchbase.client.ViewConnection:  Shut down Couchbase client
2012-04-24 11:05:12.374 INFO com.couchbase.client.ViewNode:  Couchbase I/O reactor terminated
[success] Total time: 6 s, completed 24.04.2012 11:05:12
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You see all the Couchbase log messages here, because the default logger logs directly to STDOUT. Right in the middle you can see the output of our synchronous &lt;a href=&#34;http://www.couchbase.com/docs/couchbase-sdk-java-1.1/couchbase-sdk-java-retrieve-get.html#table-couchbase-sdk_java_get&#34;&gt;get&lt;/a&gt; operation. You should also see the
created document in your Couchbase &lt;a href=&#34;http://localhost:8091/index.html#sec=documents&amp;amp;bucketName=default&#34;&gt;default bucket&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s go through the main code line by line and see what&amp;rsquo;s going on.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;val uris = ArrayBuffer(URI.create(&amp;quot;http://127.0.0.1:8091/pools&amp;quot;))   
val client = new CouchbaseClient(uris, &amp;quot;default&amp;quot;, &amp;quot;&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;CouchbaseClient&lt;/code&gt; accepts a list of URIs to communicate with as the first argument (you need to import &lt;code&gt;collection.JavaConversions._&lt;/code&gt;, so that &lt;code&gt;Ã€rrayBuffer&lt;/code&gt; gets
converted to a &lt;code&gt;java.util.List&lt;/code&gt;). The second argument is the bucket name, the third one is an optional bucket password (which is always empty for the &lt;code&gt;default&lt;/code&gt; one).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;client.set(&amp;quot;hello&amp;quot;, 0, &amp;quot;world&amp;quot;)
println(&amp;quot;Receiving -&amp;gt; &amp;quot; + client.get(&amp;quot;hello&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can now throw all commands at the client, be it synchronous or asynchronous ones. You can find all supported methods &lt;a href=&#34;http://www.couchbase.com/docs/couchbase-sdk-java-1.1/api-reference-summary.html&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;client.shutdown()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally, we close the connection to the server. You can pass optional timeouts here, so that the client waits for the given amount of time before it finally closes the connection.
This allows asynchronous commands to finish first.&lt;/p&gt;

&lt;p&gt;This post was a very basic introduction on using Couchbase from Scala. The next post will translate the &lt;a href=&#34;http://www.couchbase.com/docs/couchbase-sdk-java-1.1/tutorial.html&#34;&gt;tutorial&lt;/a&gt; to Scala. As always, I&amp;rsquo;m open to suggestions and
improvements!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>